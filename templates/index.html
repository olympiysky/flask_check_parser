<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü–∞—Ä—Å–µ—Ä —á–µ–∫–æ–≤</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        textarea { width: 100%; font-family: monospace; }
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        table, th, td { border: 1px solid #aaa; }
        th, td { padding: 6px 10px; text-align: left; }
        .error { color: red; font-weight: bold; }
        hr { border: none; border-top: 1px dashed #999; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>–ó–∞–≥—Ä—É–∑–∫–∞ —á–µ–∫–æ–≤</h1>
    <form method="post">
        <textarea name="urls" rows="10" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —á–µ–∫–∏, –ø–æ –æ–¥–Ω–æ–π –≤ —Å—Ç—Ä–æ–∫–µ"></textarea><br>
        <button type="submit">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
    </form>

    {% if error %}
        <div class="error">{{ error }}</div>
    {% endif %}

    {% if result %}
        <h3>–°–≤–æ–¥–∫–∞ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º/–≥–æ—Ä–æ–¥–∞–º:</h3>
        {% for region, data in result.grouped_by_region.items() %}
            <h4>üìç {{ region }}</h4>
            <p><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤:</strong> {{ data.stats.count }}</p>
            <p><strong>–û–±—â–∞—è —Å—É–º–º–∞:</strong> {{ "%.2f"|format(data.stats.amount) }} ‚Ç∏</p>
            <ul>
                {% for p in data.products %}
                    <li>[{{ p.category }}] {{ p.name }} ‚Äî –°–∞–Ω—ã: {{ p.qty }} ‚Üí {{ p.total }}</li>
                {% endfor %}
            </ul>
            <hr>
        {% endfor %}
    {% endif %}
</body>
</html>
